Source: Timo Gurr <tgurr@exherbo.org>
Upstream: No
Reason: Allow additional tests to (x-)fail

diff -Naur glibc-2.27/debug/Makefile glibc-2.27.new/debug/Makefile
--- glibc-2.27/debug/Makefile	2018-08-01 07:10:47.000000000 +0200
+++ glibc-2.27.new/debug/Makefile	2018-08-01 19:55:51.049820568 +0200
@@ -181,6 +181,9 @@
 endif
 generated += catchsegv xtrace
 
+# Exherbo
+test-xfail-tst-longjmp_chk = yes
+
 include ../Rules
 
 ifeq ($(run-built-tests),yes)
diff -Naur glibc-2.27/conform/Makefile glibc-2.27.new/conform/Makefile
--- glibc-2.27/conform/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/conform/Makefile	2018-02-02 14:46:31.334893347 +0100
@@ -239,3 +239,10 @@
 test-xfail-UNIX98/ndbm.h/linknamespace = yes
 test-xfail-XOPEN2K/ndbm.h/linknamespace = yes
 test-xfail-XOPEN2K8/ndbm.h/linknamespace = yes
+
+# Exherbo
+test-xfail-UNIX98/stdlib.h/linknamespace = yes
+test-xfail-XOPEN2K/stdlib.h/linknamespace = yes
+test-xfail-XOPEN2K8/stdlib.h/linknamespace = yes
+test-xfail-XPG3/stdlib.h/linknamespace = yes
+test-xfail-XPG4/stdlib.h/linknamespace = yes
diff -Naur glibc-2.27/elf/Makefile glibc-2.27.new/elf/Makefile
--- glibc-2.27/elf/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/elf/Makefile	2018-02-02 14:46:31.334893347 +0100
@@ -395,6 +395,11 @@
 CFLAGS-tst-linkall-static.c += -UUSE_CRYPT -DUSE_CRYPT=0
 endif
 
+# Exherbo
+test-xfail-tst-ld-sse-use = yes
+test-xfail-tst-protected1a = yes
+test-xfail-tst-protected1b = yes
+
 include ../Rules
 
 ifeq (yes,$(build-shared))
diff -Naur glibc-2.27/gmon/Makefile glibc-2.27.new/gmon/Makefile
--- glibc-2.27/gmon/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/gmon/Makefile	2018-02-02 14:51:14.978416315 +0100
@@ -81,6 +81,11 @@
 endif
 
 
+# Exherbo
+test-xfail-tst-gmon-gprof = yes
+test-xfail-tst-gmon-pie-gprof = yes
+test-xfail-tst-gmon-static-gprof = yes
+
 include ../Rules
 
 # We cannot compile mcount.c with -pg because that would
diff -Naur glibc-2.27/io/Makefile glibc-2.27.new/io/Makefile
--- glibc-2.27/io/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/io/Makefile	2018-02-02 14:46:31.335893348 +0100
@@ -82,6 +82,9 @@
 tests-special += $(objpfx)ftwtest.out
 endif
 
+# Exherbo
+test-xfail-tst-open-tmpfile = yes
+
 include ../Rules
 
 CFLAGS-open.c += -fexceptions -fasynchronous-unwind-tables
diff -Naur glibc-2.27/localedata/Makefile glibc-2.27.new/localedata/Makefile
--- glibc-2.27/localedata/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/localedata/Makefile	2018-02-02 14:46:31.335893348 +0100
@@ -88,6 +88,9 @@
 endif
 endif
 
+# Exherbo
+test-xfail-sort-test = yes
+
 # Files to install.
 install-others := $(addprefix $(inst_i18ndir)/, \
 			      $(addsuffix .gz, $(charmaps)) \
diff -Naur glibc-2.27/misc/Makefile glibc-2.27.new/misc/Makefile
--- glibc-2.27/misc/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/misc/Makefile	2018-02-02 14:46:31.335893348 +0100
@@ -126,6 +126,9 @@
 CFLAGS-brk.o = $(no-stack-protector)
 CFLAGS-brk.op = $(no-stack-protector)
 
+# Exherbo
+test-xfail-tst-clone3 = yes
+
 include ../Rules
 
 $(objpfx)libg.a: $(dep-dummy-lib); $(make-dummy-lib)
diff -Naur glibc-2.27/nptl/Makefile glibc-2.27.new/nptl/Makefile
--- glibc-2.27/nptl/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/nptl/Makefile	2018-02-02 14:46:31.362893398 +0100
@@ -324,6 +324,32 @@
 # 18435 - pthread_once hangs when init routine throws an exception.
 test-xfail-tst-once5 = yes
 
+# Exherbo
+test-xfail-tst-cancel24 = yes
+test-xfail-tst-cancelx4 = yes
+test-xfail-tst-cancelx5 = yes
+test-xfail-tst-cancelx9 = yes
+test-xfail-tst-cancelx10 = yes
+test-xfail-tst-cancelx11 = yes
+test-xfail-tst-cancelx12 = yes
+test-xfail-tst-cancelx13 = yes
+test-xfail-tst-cancelx14 = yes
+test-xfail-tst-cancelx15 = yes
+test-xfail-tst-cancelx16 = yes
+test-xfail-tst-cancelx17 = yes
+test-xfail-tst-cancelx18 = yes
+test-xfail-tst-cancelx20 = yes
+test-xfail-tst-cancelx21 = yes
+test-xfail-tst-cleanupx0 = yes
+test-xfail-tst-cleanupx1 = yes
+test-xfail-tst-cleanupx3 = yes
+test-xfail-tst-cleanupx4 = yes
+test-xfail-tst-mqueue5 = yes
+test-xfail-tst-oncex3 = yes
+test-xfail-tst-oncex4 = yes
+test-xfail-tst-robust8 = yes
+test-xfail-tst-thread-exit-clobber = yes
+
 # Files which must not be linked with libpthread.
 tests-nolibpthread = tst-unload
 
diff -Naur glibc-2.27/posix/Makefile glibc-2.27.new/posix/Makefile
--- glibc-2.27/posix/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/posix/Makefile	2018-02-02 14:46:31.363893400 +0100
@@ -149,6 +149,12 @@
 xtests-special += $(objpfx)bug-ga2-mem.out
 endif
 
+# Exherbo
+test-xfail-test-errno = yes
+test-xfail-tst-dir = yes
+test-xfail-tst-getaddrinfo4 = yes
+test-xfail-tst-getaddrinfo5 = yes
+
 include ../Rules
 
 ifeq ($(run-built-tests),yes)
diff -Naur glibc-2.27/resolv/Makefile glibc-2.27.new/resolv/Makefile
--- glibc-2.27/resolv/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/resolv/Makefile	2018-02-02 14:48:46.465142640 +0100
@@ -126,6 +126,18 @@
 	     mtrace-tst-leaks2.out tst-leaks2.mtrace \
 	     mtrace-tst-resolv-res_ninit.out tst-resolv-res_ninit.mtrace \
 
+# Exherbo
+test-xfail-tst-bug18665-tcp = yes
+test-xfail-tst-res_use_inet6 = yes
+test-xfail-tst-resolv-basic = yes
+test-xfail-tst-resolv-search = yes
+test-xfail-tst-resolv-canonname = yes
+test-xfail-tst-resolv-edns = yes
+test-xfail-tst-resolv-network = yes
+test-xfail-tst-resolv-res_init = yes
+test-xfail-tst-resolv-res_init-thread = yes
+test-xfail-tst-resolv-threads = yes
+
 include ../Rules
 
 CFLAGS-res_hconf.c += -fexceptions
diff -Naur glibc-2.27/rt/Makefile glibc-2.27.new/rt/Makefile
--- glibc-2.27/rt/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/rt/Makefile	2018-02-02 14:46:31.363893400 +0100
@@ -55,6 +55,9 @@
 	 tst-cputimer1 tst-cputimer2 tst-cputimer3 \
 	 tst-clock2 tst-shm-cancel
 
+# Exherbo
+test-xfail-tst-mqueue8x = yes
+
 extra-libs := librt
 extra-libs-others := $(extra-libs)
 
diff -Naur glibc-2.27/sunrpc/Makefile glibc-2.27.new/sunrpc/Makefile
--- glibc-2.27/sunrpc/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/sunrpc/Makefile	2018-02-02 14:46:31.364893402 +0100
@@ -127,6 +127,11 @@
 extra-objs += $(addsuffix .os,$(rpc-compat-routines))
 endif
 
+# Exherbo
+test-xfail-bug20790 = yes
+test-xfail-tst-udp-nonblocking = yes
+test-xfail-tst-udp-timeout = yes
+
 include ../Rules
 
 ifeq (yes,$(build-shared))
diff -Naur glibc-2.27/support/Makefile glibc-2.27.new/support/Makefile
--- glibc-2.27/support/Makefile	2018-02-01 17:17:18.000000000 +0100
+++ glibc-2.27.new/support/Makefile	2018-02-02 14:46:31.364893402 +0100
@@ -168,4 +168,7 @@
 
 $(objpfx)tst-support_format_dns_packet: $(common-objpfx)resolv/libresolv.so
 
+# Exherbo
+test-xfail-tst-support-namespace = yes
+
 include ../Rules

From 50bb2e5d5665bb8416a265b53c7a69e22a20ed42 Mon Sep 17 00:00:00 2001
From: Saleem Abdulrasool <compnerd@compnerd.org>
Date: Fri, 17 Jun 2016 18:19:03 +0000
Subject: [PATCH] support canonical windows targets

This adds support for the canonical Windows target spellings as observed by
LLVM/clang.
---
 bfd/config.bfd        | 14 +++++++-------
 binutils/configure    |  2 +-
 binutils/configure.ac |  2 +-
 gas/configure.tgt     | 10 +++++-----
 ld/configure.tgt      |  6 +++---
 5 files changed, 17 insertions(+), 17 deletions(-)

diff --git a/bfd/config.bfd b/bfd/config.bfd
index dc24aabad5..61de548d53 100644
--- a/bfd/config.bfd
+++ b/bfd/config.bfd
@@ -801,9 +801,9 @@ case "${targ}" in
     targ_archs="$targ_archs bfd_arm_arch"
     want64=true
     ;;
-  x86_64-*-mingw* | x86_64-*-pe | x86_64-*-pep | x86_64-*-cygwin)
+  x86_64-*-mingw* | x86_64-*-pe | x86_64-*-pep | x86_64-*-cygwin | x86_64-*-windows-*)
     targ_defvec=x86_64_pe_vec
-    targ_selvecs="x86_64_pe_vec x86_64_pei_vec x86_64_pe_be_vec x86_64_elf64_vec l1om_elf64_vec k1om_elf64_vec i386_pe_vec i386_pei_vec i386_elf32_vec iamcu_elf32_vec"
+    targ_selvecs="x86_64_pe_vec x86_64_pei_vec x86_64_pe_be_vec i386_pe_vec i386_pei_vec" # x86_64_elf64_vec l1om_elf64_vec k1om_elf64_vec i386_elf32_vec iamcu_elf32_vec"
     want64=true
     targ_underscore=no
     ;;
@@ -821,6 +821,11 @@ case "${targ}" in
     targ_defvec=i386_elf32_vec
     targ_selvecs="iamcu_elf32_vec i386_coff_lynx_vec i386_aout_lynx_vec"
     ;;
+  i[3-7]86-*-mingw32* | i[3-7]86-*-cygwin* | i[3-7]86-*-winnt | i[3-7]86-*-pe | i[3-7]86-*-windows-*)
+    targ_defvec=i386_pe_vec
+    targ_selvecs="i386_pe_vec i386_pei_vec" # i386_elf32_vec iamcu_elf32_vec"
+    targ_underscore=yes
+    ;;
   i[3-7]86-*-gnu*)
     targ_defvec=i386_elf32_vec
     targ_selvecs=iamcu_elf32_vec
@@ -859,11 +864,6 @@ case "${targ}" in
     targ_defvec=i386_elf32_vec
     targ_selvecs="iamcu_elf32_vec i386_coff_vec"
     ;;
-  i[3-7]86-*-mingw32* | i[3-7]86-*-cygwin* | i[3-7]86-*-winnt | i[3-7]86-*-pe)
-    targ_defvec=i386_pe_vec
-    targ_selvecs="i386_pe_vec i386_pei_vec i386_elf32_vec iamcu_elf32_vec"
-    targ_underscore=yes
-    ;;
   i[3-7]86-none-*)
     targ_defvec=i386_coff_vec
     ;;
diff --git a/binutils/configure b/binutils/configure
index 38d08d0b3d..c0778a584a 100755
--- a/binutils/configure
+++ b/binutils/configure
@@ -14515,7 +14515,7 @@ do
 	  BUILD_WINDMC='$(WINDMC_PROG)$(EXEEXT)'
 	  BUILD_DLLWRAP='$(DLLWRAP_PROG)$(EXEEXT)'
 	  ;;
-	i[3-7]86-*-pe* | i[3-7]86-*-cygwin* | i[3-7]86-*-mingw32** | i[3-7]86-*-netbsdpe*)
+	i[3-7]86-*-pe* | i[3-7]86-*-cygwin* | i[3-7]86-*-mingw32** | i[3-7]86-*-netbsdpe* | i[3-7]86-*-windows-*)
   	  BUILD_DLLTOOL='$(DLLTOOL_PROG)$(EXEEXT)'
 	  if test -z "$DLLTOOL_DEFAULT"; then
 	    DLLTOOL_DEFAULT="-DDLLTOOL_DEFAULT_I386"
diff --git a/binutils/configure.ac b/binutils/configure.ac
index fbd366ae99..613e40bec9 100644
--- a/binutils/configure.ac
+++ b/binutils/configure.ac
@@ -326,7 +326,7 @@ changequote([,])dnl
 	  BUILD_DLLWRAP='$(DLLWRAP_PROG)$(EXEEXT)'
 	  ;;
 changequote(,)dnl
-	i[3-7]86-*-pe* | i[3-7]86-*-cygwin* | i[3-7]86-*-mingw32** | i[3-7]86-*-netbsdpe*)
+	i[3-7]86-*-pe* | i[3-7]86-*-cygwin* | i[3-7]86-*-mingw32** | i[3-7]86-*-netbsdpe* | i[3-7]86-*-windows-*)
 changequote([,])dnl
   	  BUILD_DLLTOOL='$(DLLTOOL_PROG)$(EXEEXT)'
 	  if test -z "$DLLTOOL_DEFAULT"; then
diff --git a/gas/configure.tgt b/gas/configure.tgt
index 9d5e781366..16acc498fa 100644
--- a/gas/configure.tgt
+++ b/gas/configure.tgt
@@ -270,6 +270,11 @@ case ${generic_target} in
   i386-*-vsta)				fmt=aout ;;
   i386-*-msdosdjgpp* \
   | i386-*-go32*)			fmt=coff em=go32 ;;
+  i386-*-mingw* | *-*-windows-*)
+    case ${cpu} in
+      x86_64*)				fmt=coff em=pep ;;
+      i*)				fmt=coff em=pe ;;
+    esac ;;
   i386-*-gnu*)				fmt=elf em=gnu ;;
   i386-*-mach*)				fmt=aout em=mach ;;
   i386-*-msdos*)			fmt=aout ;;
@@ -281,11 +286,6 @@ case ${generic_target} in
      i*)				fmt=coff em=pe ;;
    esac ;;
   i386-*-interix*)			fmt=coff em=interix ;;
-  i386-*-mingw*)
-    case ${cpu} in
-      x86_64*)				fmt=coff em=pep ;;
-      i*)				fmt=coff em=pe ;;
-    esac ;;
   i386-*-nto-qnx*)			fmt=elf ;;
   i386-*-*nt*)				fmt=coff em=pe ;;
   i386-*-chaos)				fmt=elf ;;
diff --git a/ld/configure.tgt b/ld/configure.tgt
index 47c719cd05..6cf9262d97 100644
--- a/ld/configure.tgt
+++ b/ld/configure.tgt
@@ -364,6 +364,8 @@ x86_64-*-freebsd* | x86_64-*-kfreebsd*-gnu)
 i[3-7]86-*-sysv*)	targ_emul=i386coff ;;
 i[3-7]86-*-ptx*)	targ_emul=i386coff ;;
 i[3-7]86-*-mach*)	targ_emul=i386mach ;;
+i[3-7]86-*-mingw32* | i[3-7]86-*-windows-*)	targ_emul=i386pe ;
+			targ_extra_ofiles="deffilep.o pe-dll.o" ;;
 i[3-7]86-*-gnu*)	targ_emul=elf_i386
 			targ_extra_emuls=elf_iamcu ;;
 i[3-7]86-*-msdos*)	targ_emul=i386msdos; targ_extra_emuls=i386aout ;;
@@ -375,8 +377,6 @@ i[3-7]86-*-pe)		targ_emul=i386pe ;
 i[3-7]86-*-cygwin*)	targ_emul=i386pe ;
 			targ_extra_ofiles="deffilep.o pe-dll.o" ;
 			test "$targ" != "$host" && LIB_PATH='${tooldir}/lib/w32api' ;;
-i[3-7]86-*-mingw32*)	targ_emul=i386pe ;
-			targ_extra_ofiles="deffilep.o pe-dll.o" ;;
 x86_64-*-pe | x86_64-*-pep) targ_emul=i386pep ;
 			targ_extra_emuls=i386pe ;
 			targ_extra_ofiles="deffilep.o pep-dll.o pe-dll.o" ;;
@@ -384,7 +384,7 @@ x86_64-*-cygwin)	targ_emul=i386pep ;
 			targ_extra_emuls=i386pe
 			targ_extra_ofiles="deffilep.o pep-dll.o pe-dll.o"
 			test "$targ" != "$host" && LIB_PATH='${tooldir}/lib/w32api' ;;
-x86_64-*-mingw*)	targ_emul=i386pep ;
+x86_64-*-mingw* | x86_64-*-windows-*)	targ_emul=i386pep ;
 			targ_extra_emuls=i386pe
 			targ_extra_ofiles="deffilep.o pep-dll.o pe-dll.o" ;;
 i[3-7]86-*-interix*)	targ_emul=i386pe_posix;
-- 
2.13.3


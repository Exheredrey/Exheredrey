Source/Upstream: Reported, https://github.com/thkukuk/rpcsvc-proto/pull/2
Reason: Fix build with prefixed CPP

From e4db0d9a7680d56f3c68091724161f7a9cbc99b0 Mon Sep 17 00:00:00 2001
From: Timo Gurr <tgurr@exherbo.org>
Date: Mon, 5 Mar 2018 13:51:38 +0100
Subject: [PATCH] Allow to use CPP specified by the environment

---
 rpcgen/cpp         | 6 ++++++
 rpcsvc/Makefile.am | 2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)
 create mode 100755 rpcgen/cpp

diff --git a/rpcgen/cpp b/rpcgen/cpp
new file mode 100755
index 0000000..dd77b57
--- /dev/null
+++ b/rpcgen/cpp
@@ -0,0 +1,6 @@
+#!/bin/sh
+
+# This script is used solely by rpcgen when run during the build.
+# It allows using CPP from the environment rather than a hardcoded path.
+
+exec ${CPP} "$@"
diff --git a/rpcsvc/Makefile.am b/rpcsvc/Makefile.am
index 83867c0..5094345 100644
--- a/rpcsvc/Makefile.am
+++ b/rpcsvc/Makefile.am
@@ -12,5 +12,5 @@ nodist_rpcsvc_HEADERS = klm_prot.h nlm_prot.h rstat.h spray.h \
 	nfs_prot.h rquota.h sm_inter.h
 
 %.h: %.x
-	$(top_builddir)/rpcgen/rpcgen -h -o $@ $<
+	CPP='$(CC) -E -x c-header' $(top_builddir)/rpcgen/rpcgen -Y $(top_srcdir)/rpcgen -h -o $@ $<
 

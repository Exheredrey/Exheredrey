# Copyright 2019 Timo Gurr <tgurr@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

require github [ user=pybind tag=v${PV} ] \
    cmake [ api=2 ] \
    python [ blacklist=none multibuild=false ]

SUMMARY="Lightweight header-only library that exposes C++ types in Python"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64"
MYOPTIONS=""

DEPENDENCIES="
    test:
        dev-python/pytest[python_abis:*(-)?]
"

CMAKE_SRC_CONFIGURE_PARAMS=(
    -DCMAKE_BUILD_TYPE:STRING=Release
    -DPYBIND11_INSTALL:BOOL=TRUE
    -DPYTHON_EXECUTABLE:PATH=${PYTHON}
)

CMAKE_SRC_CONFIGURE_TESTS=(
    -DCMAKE_DISABLE_FIND_PACKAGE_Boost:BOOL=TRUE
    -DCMAKE_DISABLE_FIND_PACKAGE_Catch:BOOL=TRUE
    -DCMAKE_DISABLE_FIND_PACKAGE_Eigen3:BOOL=TRUE
    '-DPYBIND11_TEST:BOOL=TRUE -DPYBIND11_TEST:BOOL=FALSE'
    -DPYBIND11_WERROR:BOOL=FALSE
)

src_install() {
    default

    dodir /usr/$(exhost --target)/lib/cmake
    edo mv "${IMAGE}"/usr/$(exhost --target)/{share,lib}/cmake/${PN}
    edo rm -rf "${IMAGE}"/usr/$(exhost --target)/share
}


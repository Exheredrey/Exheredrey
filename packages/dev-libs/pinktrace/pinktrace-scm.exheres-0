# Copyright 2010, 2013 Ali Polatel <alip@exherbo.org>
# Distributed under the terms of the GNU General Public License v2

SCM_REPOSITORY="https://git.exherbo.org/pinktrace-1.git"

require autotools [ supported_autoconf=[ 2.5 ] supported_automake=[ 1.15 1.13 1.11 1.10 ] ]
require scm-git pinktrace

PLATFORMS="~amd64 ~arm ~armv7"
MYOPTIONS="doc
    pvm [[ description = [ Use process_vm_{r,w}*() rather than ptrace() to read process mem. ] ]]
"

DEPENDENCIES="
    build:
        doc? ( app-doc/doxygen )
"

AT_M4DIR=( m4 )

DEFAULT_SRC_CONFIGURE_PARAMS=( --enable-ipv6 )
DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( 'doc doxygen' )

src_configure() {
    autotools_src_configure
    default

    option pvm || edo sed -i -e '/^#define PINK_HAVE_PROCESS_VM_\(READ\|WRITE\)V/s/1/0/' pinktrace/system.h
}
